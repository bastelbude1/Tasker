# TASKER Execution Types Configuration
# Defines platform-specific execution type implementations
#
# Note: exec=local is always hardcoded and does not require configuration
#
# Template Variables:
#   {binary}           - The executable binary name
#   {hostname}         - Target hostname from task definition
#   {command}          - Command from task definition
#   {arguments}        - Arguments as a single string
#   {arguments_split}  - Arguments split into array using shlex.split()
#
# Validation Test Format:
#   command: Command to execute for connectivity testing (mandatory)
#   arguments: Arguments for the validation command (optional, defaults to "")
#   expected_exit: Expected exit code (typically 0)
#   expected_output: String that must appear in stdout (e.g., "OK")
#
# Timeout Configuration:
#   default_timeout: Platform-level default timeout in seconds (optional)
#   timeout: Exec-type specific timeout in seconds (optional)
#   Priority: Task timeout > Exec-type timeout > Platform timeout > Env var > Hardcoded 300

platforms:
  # Linux execution type definitions
  linux:
    # Default execution type for Linux (if not specified in task, CLI, or env var)
    # Fallback: 'local' (hardcoded, always safe)
    default_exec_type: pbrun

    # Platform-level default timeout for all Linux exec types (in seconds)
    # Can be overridden at exec-type level or task level
    default_timeout: 300

    shell:
      description: "Local shell execution with Bash"
      binary: /bin/bash
      command_template:
        - "{binary}"
        - "-c"
        - "{command} {arguments}"
      validation_test:
        command: "echo"
        arguments: "OK"
        expected_exit: 0
        expected_output: "OK"

    pbrun:
      description: "PowerBroker remote execution"
      binary: pbrun
      # Remote operations may need more time
      timeout: 600
      command_template:
        - "{binary}"
        - "-n"
        - "-h"
        - "{hostname}"
        - "{command}"
        - "{arguments_split}"
      validation_test:
        command: pbtest
        expected_exit: 0
        expected_output: "OK"

    p7s:
      description: "P7S remote execution"
      binary: p7s
      command_template:
        - "{binary}"
        - "{hostname}"
        - "{command}"
        - "{arguments_split}"
      validation_test:
        command: pbtest
        expected_exit: 0
        expected_output: "OK"

    wwrs:
      description: "WWRS remote execution (wwrs_clir binary)"
      binary: wwrs_clir
      command_template:
        - "{binary}"
        - "{hostname}"
        - "{command}"
        - "{arguments_split}"
      validation_test:
        command: wwrs_test
        expected_exit: 0
        expected_output: "OK"

  # Windows execution type definitions (future support)
  windows:
    # Default execution type for Windows
    default_exec_type: shell

    # Platform-level default timeout for all Windows exec types (in seconds)
    default_timeout: 300

    shell:
      description: "Local shell execution with cmd.exe"
      binary: cmd.exe
      command_template:
        - "{binary}"
        - "/c"
        - "{command} {arguments}"
      validation_test: null

    # Windows remote execution tools can be added here
    # Example:
    # psexec:
    #   description: "PsExec remote execution"
    #   binary: psexec.exe
    #   command_template:
    #     - "{binary}"
    #     - "\\\\{hostname}"
    #     - "{command}"
    #     - "{arguments_split}"

# Execution type aliases (optional)
# Maps alternative names to canonical execution types
aliases:
  bash: shell
  sh: shell
  "/bin/bash": shell
  "/bin/sh": shell
  cmd: shell  # Windows only
