# TEST_METADATA: {"description": "Comprehensive retry validation test","test_type": "validation_only","expected_exit_code": 20,"expected_success": false,"skip_host_validation": true}
# COMPREHENSIVE RETRY VALIDATION TEST CASE
# Tests all retry validation rules in task_validator.py
# This file is designed to trigger various validation errors and warnings

# === GLOBAL VARIABLES FOR TESTING ===
RETRY_COUNT_VALID=3
RETRY_COUNT_HIGH=15
RETRY_COUNT_INVALID=abc
RETRY_DELAY_VALID=2
RETRY_DELAY_HIGH=500
HOSTNAME=localhost

# ====================================================================
# SECTION 1: VALID RETRY CONFIGURATIONS (Should pass validation)
# ====================================================================

# Test 1.1: Complete valid retry configuration
task=10
type=parallel
max_parallel=2
tasks=100,101
retry_failed=true
retry_count=3
retry_delay=2
timeout=10
next=min_success=1

# Test 1.2: Minimal valid retry configuration (defaults will be used)
task=11
type=parallel
max_parallel=2
tasks=102,103
retry_failed=true
timeout=10
next=any_success

# Test 1.3: Retry disabled explicitly
task=12
type=parallel
max_parallel=2
tasks=104,105
retry_failed=false
retry_count=0
retry_delay=0
timeout=10
next=all_success

# Test 1.4: Valid retry with global variables
task=13
type=parallel
max_parallel=2
tasks=106,107
retry_failed=true
retry_count=@RETRY_COUNT_VALID@
retry_delay=@RETRY_DELAY_VALID@
timeout=10
next=min_success=1

# ====================================================================
# SECTION 2: RETRY FIELDS IN NON-PARALLEL TASKS (Should generate warnings)
# ====================================================================

# Test 2.1: Normal task with retry_failed (WARNING expected)
task=20
hostname=@HOSTNAME@
command=echo
arguments=This should generate warning about retry in non-parallel task
exec=local
retry_failed=true

# Test 2.2: Normal task with all retry fields (WARNING expected)
task=21
hostname=@HOSTNAME@
command=echo
arguments=This should generate warning about retry fields
exec=local
retry_failed=true
retry_count=2
retry_delay=1

# Test 2.3: Return task with retry fields (WARNING expected)
task=22
return=0
retry_failed=true
retry_count=1

# ====================================================================
# SECTION 3: INVALID RETRY VALUES (Should generate errors)
# ====================================================================

# Test 3.1: Invalid retry_failed value (ERROR expected)
task=30
type=parallel
max_parallel=2
tasks=108,109
retry_failed=maybe
retry_count=2
retry_delay=1
timeout=10
next=any_success

# Test 3.2: Invalid retry_count value - non-integer (ERROR expected)
task=31
type=parallel
max_parallel=2
tasks=110,111
retry_failed=true
retry_count=@RETRY_COUNT_INVALID@
retry_delay=1
timeout=10
next=any_success

# Test 3.3: Negative retry_count (ERROR expected)
task=32
type=parallel
max_parallel=2
tasks=112,113
retry_failed=true
retry_count=-1
retry_delay=1
timeout=10
next=any_success

# Test 3.4: Invalid retry_delay value - non-integer (ERROR expected)
task=33
type=parallel
max_parallel=2
tasks=114,115
retry_failed=true
retry_count=2
retry_delay=not_a_number
timeout=10
next=any_success

# Test 3.5: Negative retry_delay (ERROR expected)
task=34
type=parallel
max_parallel=2
tasks=116,117
retry_failed=true
retry_count=2
retry_delay=-5
timeout=10
next=any_success

# ====================================================================
# SECTION 4: INCONSISTENT RETRY CONFIGURATIONS (Should generate warnings)
# ====================================================================

# Test 4.1: retry_count without retry_failed (WARNING expected)
task=40
type=parallel
max_parallel=2
tasks=118,119
retry_count=3
retry_delay=1
timeout=10
next=any_success

# Test 4.2: retry_delay without retry_failed (WARNING expected)
task=41
type=parallel
max_parallel=2
tasks=120,121
retry_delay=2
timeout=10
next=any_success

# Test 4.3: retry_failed=true but missing retry_count (WARNING expected)
task=42
type=parallel
max_parallel=2
tasks=122,123
retry_failed=true
retry_delay=1
timeout=10
next=any_success

# Test 4.4: retry_failed=true but missing retry_delay (WARNING expected)
task=43
type=parallel
max_parallel=2
tasks=124,125
retry_failed=true
retry_count=2
timeout=10
next=any_success

# ====================================================================
# SECTION 5: EXTREME VALUES (Should generate warnings)
# ====================================================================

# Test 5.1: High retry_count (WARNING expected)
task=50
type=parallel
max_parallel=2
tasks=126,127
retry_failed=true
retry_count=@RETRY_COUNT_HIGH@
retry_delay=1
timeout=10
next=any_success

# Test 5.2: Very high retry_count (WARNING expected)
task=51
type=parallel
max_parallel=2
tasks=128,129
retry_failed=true
retry_count=25
retry_delay=1
timeout=10
next=any_success

# Test 5.3: High retry_delay (WARNING expected)
task=52
type=parallel
max_parallel=2
tasks=130,131
retry_failed=true
retry_count=2
retry_delay=@RETRY_DELAY_HIGH@
timeout=10
next=any_success

# Test 5.4: Very high retry_delay (WARNING expected)
task=53
type=parallel
max_parallel=2
tasks=132,133
retry_failed=true
retry_count=2
retry_delay=600
timeout=10
next=any_success

# ====================================================================
# SECTION 6: EDGE CASES (Should generate specific warnings)
# ====================================================================

# Test 6.1: retry_count=0 (WARNING expected)
task=60
type=parallel
max_parallel=2
tasks=134,135
retry_failed=true
retry_count=0
retry_delay=1
timeout=10
next=any_success

# Test 6.2: Valid retry configuration with complex next condition
task=61
type=parallel
max_parallel=3
tasks=136,137,138
retry_failed=true
retry_count=2
retry_delay=1
timeout=15
next=min_success=2

# Test 6.3: Retry with loop (valid combination)
task=62
type=parallel
max_parallel=2
tasks=139,140
retry_failed=true
retry_count=1
retry_delay=1
timeout=10
next=loop
loop=3

# ====================================================================
# SECTION 7: MIXED VALID AND INVALID (Complex scenarios)
# ====================================================================

# Test 7.1: Some valid, some invalid retry settings
task=70
type=parallel
max_parallel=3
tasks=141,142,143
retry_failed=yes
retry_count=3
retry_delay=2
timeout=10
next=max_failed=1

# Test 7.2: Valid retry with undefined global variable (ERROR expected)
task=71
type=parallel
max_parallel=2
tasks=144,145
retry_failed=true
retry_count=@UNDEFINED_RETRY_COUNT@
retry_delay=1
timeout=10
next=any_success

# ====================================================================
# PARALLEL TASK DEFINITIONS (Required for parallel task validation)
# ====================================================================

# Tasks for Section 1 tests
task=100
hostname=@HOSTNAME@
command=echo
arguments=Task 100 for retry test
exec=local

task=101
hostname=@HOSTNAME@
command=echo
arguments=Task 101 for retry test
exec=local

task=102
hostname=@HOSTNAME@
command=echo
arguments=Task 102 for retry test
exec=local

task=103
hostname=@HOSTNAME@
command=echo
arguments=Task 103 for retry test
exec=local

task=104
hostname=@HOSTNAME@
command=echo
arguments=Task 104 for retry test
exec=local

task=105
hostname=@HOSTNAME@
command=echo
arguments=Task 105 for retry test
exec=local

task=106
hostname=@HOSTNAME@
command=echo
arguments=Task 106 for retry test
exec=local

task=107
hostname=@HOSTNAME@
command=echo
arguments=Task 107 for retry test
exec=local

# Tasks for Section 3 tests
task=108
hostname=@HOSTNAME@
command=echo
arguments=Task 108 for invalid retry test
exec=local

task=109
hostname=@HOSTNAME@
command=echo
arguments=Task 109 for invalid retry test
exec=local

task=110
hostname=@HOSTNAME@
command=echo
arguments=Task 110 for invalid retry test
exec=local

task=111
hostname=@HOSTNAME@
command=echo
arguments=Task 111 for invalid retry test
exec=local

task=112
hostname=@HOSTNAME@
command=echo
arguments=Task 112 for invalid retry test
exec=local

task=113
hostname=@HOSTNAME@
command=echo
arguments=Task 113 for invalid retry test
exec=local

task=114
hostname=@HOSTNAME@
command=echo
arguments=Task 114 for invalid retry test
exec=local

task=115
hostname=@HOSTNAME@
command=echo
arguments=Task 115 for invalid retry test
exec=local

task=116
hostname=@HOSTNAME@
command=echo
arguments=Task 116 for invalid retry test
exec=local

task=117
hostname=@HOSTNAME@
command=echo
arguments=Task 117 for invalid retry test
exec=local

# Tasks for Section 4 tests
task=118
hostname=@HOSTNAME@
command=echo
arguments=Task 118 for inconsistent retry test
exec=local

task=119
hostname=@HOSTNAME@
command=echo
arguments=Task 119 for inconsistent retry test
exec=local

task=120
hostname=@HOSTNAME@
command=echo
arguments=Task 120 for inconsistent retry test
exec=local

task=121
hostname=@HOSTNAME@
command=echo
arguments=Task 121 for inconsistent retry test
exec=local

task=122
hostname=@HOSTNAME@
command=echo
arguments=Task 122 for inconsistent retry test
exec=local

task=123
hostname=@HOSTNAME@
command=echo
arguments=Task 123 for inconsistent retry test
exec=local

task=124
hostname=@HOSTNAME@
command=echo
arguments=Task 124 for inconsistent retry test
exec=local

task=125
hostname=@HOSTNAME@
command=echo
arguments=Task 125 for inconsistent retry test
exec=local

# Tasks for Section 5 tests (extreme values)
task=126
hostname=@HOSTNAME@
command=echo
arguments=Task 126 for extreme values test
exec=local

task=127
hostname=@HOSTNAME@
command=echo
arguments=Task 127 for extreme values test
exec=local

task=128
hostname=@HOSTNAME@
command=echo
arguments=Task 128 for extreme values test
exec=local

task=129
hostname=@HOSTNAME@
command=echo
arguments=Task 129 for extreme values test
exec=local

task=130
hostname=@HOSTNAME@
command=echo
arguments=Task 130 for extreme values test
exec=local

task=131
hostname=@HOSTNAME@
command=echo
arguments=Task 131 for extreme values test
exec=local

task=132
hostname=@HOSTNAME@
command=echo
arguments=Task 132 for extreme values test
exec=local

task=133
hostname=@HOSTNAME@
command=echo
arguments=Task 133 for extreme values test
exec=local

# Tasks for Section 6 tests (edge cases)
task=134
hostname=@HOSTNAME@
command=echo
arguments=Task 134 for edge case test
exec=local

task=135
hostname=@HOSTNAME@
command=echo
arguments=Task 135 for edge case test
exec=local

task=136
hostname=@HOSTNAME@
command=echo
arguments=Task 136 for edge case test
exec=local

task=137
hostname=@HOSTNAME@
command=echo
arguments=Task 137 for edge case test
exec=local

task=138
hostname=@HOSTNAME@
command=echo
arguments=Task 138 for edge case test
exec=local

task=139
hostname=@HOSTNAME@
command=echo
arguments=Task 139 for edge case test
exec=local

task=140
hostname=@HOSTNAME@
command=echo
arguments=Task 140 for edge case test
exec=local

# Tasks for Section 7 tests (mixed scenarios)
task=141
hostname=@HOSTNAME@
command=echo
arguments=Task 141 for mixed scenario test
exec=local

task=142
hostname=@HOSTNAME@
command=echo
arguments=Task 142 for mixed scenario test
exec=local

task=143
hostname=@HOSTNAME@
command=echo
arguments=Task 143 for mixed scenario test
exec=local

task=144
hostname=@HOSTNAME@
command=echo
arguments=Task 144 for mixed scenario test
exec=local

task=145
hostname=@HOSTNAME@
command=echo
arguments=Task 145 for mixed scenario test
exec=local

# ====================================================================
# EXPECTED VALIDATION RESULTS SUMMARY
# ====================================================================
#
# ERRORS (should be flagged as validation errors):
# - Task 30: Invalid retry_failed value 'maybe'
# - Task 31: Invalid retry_count '@RETRY_COUNT_INVALID@' (global var with non-integer)
# - Task 32: Negative retry_count -1
# - Task 33: Invalid retry_delay 'not_a_number'
# - Task 34: Negative retry_delay -5
# - Task 70: Invalid retry_failed value 'yes'
# - Task 71: Undefined global variable '@UNDEFINED_RETRY_COUNT@'
#
# WARNINGS (should be flagged as validation warnings):
# - Tasks 20,21,22: Retry fields used in non-parallel tasks
# - Tasks 40,41: retry_count/retry_delay without retry_failed
# - Tasks 42,43: retry_failed=true but missing retry_count/retry_delay
# - Tasks 50,51: High retry_count values (>10)
# - Tasks 52,53: High retry_delay values (>300)
# - Task 60: retry_count=0 effectively disables retry
# - 1 unused global variable: RETRY_COUNT_INVALID
#
# VALID (should pass without issues):
# - Tasks 10,11,12,13: Proper retry configurations for parallel tasks
# - Tasks 61,62: Complex but valid retry scenarios
# - All task definitions (100-145): Standard task definitions
#
# This test case comprehensively validates all retry-related rules
# implemented in the enhanced task_validator.py
