# TEST_METADATA: {"description": "Timeout test parallel","test_type": "positive","expected_exit_code": 0,"expected_success": true,"skip_host_validation": true}
# TIMEOUT TEST FOR PARALLEL TASKS
# Tests timeout behavior with mixed completion times

# === TIMEOUT TEST 1: Global timeout shorter than some tasks ===
task=0
hostname=localhost
command=echo
arguments=Starting timeout test - global timeout 6s, some tasks take 7s+
exec=local

task=1
type=parallel
max_parallel=5
tasks=100,101,102,103,104
timeout=6
next=min_success=2
on_success=2
on_failure=50

task=2
hostname=localhost
command=echo
arguments=SUCCESS: Timeout test - got partial results: @100_success@ @101_success@ @102_success@ @103_success@ @104_success@
exec=local

# === TIMEOUT TEST 2: Individual task timeouts vs global timeout ===
task=10
hostname=localhost
command=echo
arguments=Testing individual vs global timeouts
exec=local

task=11
type=parallel
max_parallel=3
tasks=200,201,202
timeout=8
next=max_failed=1
on_success=12
on_failure=55

task=12
hostname=localhost
command=echo
arguments=SUCCESS: Individual timeout test passed
exec=local
next=never

# === ERROR HANDLERS ===
task=50
hostname=localhost
command=echo
arguments=ERROR: Global timeout test failed - should have gotten partial results
exec=local
next=never

task=55
hostname=localhost
command=echo
arguments=ERROR: Individual timeout test failed
exec=local
next=never

# === FIREWALL ===
task=99
return=0

# ===============================================
# PARALLEL TASKS WITH DIFFERENT SLEEP TIMES
# ===============================================

# Fast completion tasks (under 5s global timeout)
task=100
hostname=localhost
command=echo
arguments=Task 100 - FAST (1s)
exec=local
sleep=1

task=101
hostname=localhost
command=echo
arguments=Task 101 - FAST (2s)
exec=local
sleep=2

# Medium completion tasks (around timeout boundary)
task=102
hostname=localhost
command=echo
arguments=Task 102 - MEDIUM (4s)
exec=local
sleep=4

# Slow tasks (exceed 5s global timeout)
task=103
hostname=localhost
command=echo
arguments=Task 103 - SLOW (7s) - should timeout
exec=local
sleep=7

task=104
hostname=localhost
command=echo
arguments=Task 104 - VERY SLOW (10s) - should timeout
exec=local
sleep=10

# Tasks with individual timeout issues (some succeed, some timeout)
task=200
hostname=localhost
command=echo
arguments=Task 200 - SUCCESS (2s)
exec=local
sleep=2

task=201
hostname=localhost
command=sh
arguments=-c "sleep 12; echo 'Task 201 - TIMEOUT (12s)'; exit 0"
exec=local

task=202
hostname=localhost
command=echo
arguments=Task 202 - SUCCESS (3s)
exec=local
sleep=3