# SIMPLIFIED PARALLEL NEXT CONDITIONS TEST
# Testing the new elegant syntax

# === TEST 1: min_success=2 (should succeed - 2 of 3 succeed) ===
task=0
hostname=localhost
command=echo
arguments=Testing min_success=2 (should succeed)
exec=local

task=1
type=parallel
max_parallel=3
tasks=10,11,12
next=min_success=2    
on_success=2
on_failure=3

task=2
hostname=localhost
command=echo
arguments=SUCCESS: min_success=2 correctly succeeded (2 of 3 tasks succeeded)
exec=local

task=3
hostname=localhost
command=echo
arguments=ERROR: min_success=2 should have succeeded
exec=local
next=never

# === TEST 2: max_failed=1 (should succeed - only 1 fails) ===
task=6
hostname=localhost
command=echo
arguments=Testing max_failed=1 (should succeed)
exec=local

task=7
type=parallel
max_parallel=3
tasks=20,21,22
next=max_failed=1   
on_success=8
on_failure=9

task=8
hostname=localhost
command=echo
arguments=SUCCESS: max_failed=1 correctly succeeded (1 failed, 2 succeeded)
exec=local

task=9
hostname=localhost
command=echo
arguments=ERROR: max_failed=1 should have succeeded
exec=local
next=never

# === TEST 3: Backwards compatibility - next=success (should show warning) ===
task=13
hostname=localhost
command=echo
arguments=Testing backwards compatibility next=success
exec=local

task=14
type=parallel
max_parallel=3
tasks=30,31,32
next=all_success         
on_success=15
on_failure=16

task=15
hostname=localhost
command=echo
arguments=ERROR: next=success should have failed (task 31 fails)
exec=local
next=never

task=16
hostname=localhost
command=echo
arguments=SUCCESS: next=success correctly failed (backwards compatibility working)
exec=local
next=never

# === TEST 4: Real-world backup scenario ===
task=20
hostname=localhost
command=echo
arguments=Starting backup of 5 servers - need at least 3 to succeed
exec=local

task=21
type=parallel
max_parallel=5
tasks=40,41,42,43,44
next=min_success=3    
on_success=22
on_failure=25

task=22
hostname=localhost
command=echo
arguments=SUCCESS: Backup completed - at least 3 servers backed up successfully
exec=local
next=never

task=25
hostname=localhost
command=echo
arguments=FAILURE: Backup failed - less than 3 servers succeeded
exec=local
next=never

# === FIREWALL ===
task=99
return=0

# ============================================
# PARALLEL TASKS (will never be reached sequentially)
# ============================================

# Tasks for TEST 1 (min_success=2)
task=10
hostname=localhost
command=echo
arguments=Task 10 succeeds
exec=local

task=11
hostname=localhost
command=sh
arguments=-c "echo 'Task 11 fails'; exit 1"
exec=local

task=12
hostname=localhost
command=echo
arguments=Task 12 succeeds
exec=local

# Tasks for TEST 3 (backwards compatibility)
task=30
hostname=localhost
command=echo
arguments=Task 30 succeeds
exec=local

task=31
hostname=localhost
command=sh
arguments=-c "echo 'Task 31 fails'; exit 1"
exec=local

task=32
hostname=localhost
command=echo
arguments=Task 32 succeeds
exec=local

# Tasks for TEST 4 (real-world backup)
task=40
hostname=localhost
command=echo
arguments=Backup server-01 succeeds
exec=local

task=41
hostname=localhost
command=sh
arguments=-c "echo 'Backup server-02 fails'; exit 1"
exec=local

task=42
hostname=localhost
command=echo
arguments=Backup server-03 succeeds
exec=local

task=43
hostname=localhost
command=echo
arguments=Backup server-04 succeeds
exec=local

task=44
hostname=localhost
command=sh
arguments=-c "echo 'Backup server-05 fails'; exit 1"
exec=local
