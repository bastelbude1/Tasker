# TEST_METADATA: {"description": "Automatic recovery - verify cleanup on success", "test_type": "positive", "expected_exit_code": 0, "expected_success": true, "requires_wrapper": "recovery_test_wrapper.sh", "wrapper_args": "--skip-host-validation", "skip_host_validation": true, "note": "Validates recovery file is deleted after successful completion"}
# Automated recovery cleanup test
# Tests that recovery file is properly deleted after workflow completion

# File-defined arguments
--auto-recovery

# Global variables
HOST_PREFIX=localhost
TARGET_HOST=@HOST_PREFIX@

# Task 0: Success
task=0
hostname=@TARGET_HOST@
exec=local
command=echo
arguments=Task 0 success

# Task 1: Stateful task - fails first run, succeeds second run
task=1
hostname=@TARGET_HOST@
exec=local
command=recovery_helper.sh
arguments=test_auto_recovery_cleanup

# Task 2: Should execute only on second run (after recovery)
task=2
hostname=@TARGET_HOST@
exec=local
command=echo
arguments=Task 2 success - recovery file should be deleted
