# TEST 5: Mixed Success/Failure/Timeout with Retry
# Tests complex scenarios with success, failure with retry, and timeout without retry

task=0
hostname=localhost
command=echo
arguments=Testing Mixed Scenarios - Success, Failure with retry, Timeout without retry
exec=local

task=1
type=parallel
max_parallel=5
tasks=500,501,502,503,504
timeout=6
retry_failed=true
retry_count=2
retry_delay=1
next=min_success=3
on_success=2
on_failure=50

task=2
hostname=localhost
command=echo
arguments=SUCCESS: Mixed scenarios test passed - retry logic correctly applied
exec=local
next=never

task=50
hostname=localhost
command=echo
arguments=ERROR: Mixed scenarios test failed
exec=local
next=never

# === FIREWALL ===
task=99
return=0

# === PARALLEL TASKS ===
# Task 500: Always succeeds immediately
task=500
hostname=localhost
command=echo
arguments=Task 500 - Immediate success
exec=local

# Task 501: Fails first time, succeeds on retry
task=501
hostname=localhost
command=sh
arguments=-c "if [ ! -f /tmp/task501_attempt ]; then touch /tmp/task501_attempt; echo 'Task 501 - First attempt fails'; exit 1; else echo 'Task 501 - Retry succeeds'; exit 0; fi"
exec=local

# Task 502: Times out (master timeout=6s, this takes 8s) - should NOT be retried
task=502
hostname=localhost
command=sleep
arguments=8
exec=local

# Task 503: Fails multiple times but eventually succeeds
task=503
hostname=localhost
command=sh
arguments=-c "attempts=$(cat /tmp/task503_counter 2>/dev/null || echo 0); attempts=$((attempts + 1)); echo $attempts > /tmp/task503_counter; if [ $attempts -le 1 ]; then echo \"Task 503 - Attempt $attempts fails\"; exit 1; else echo \"Task 503 - Succeeds on attempt $attempts\"; exit 0; fi"
exec=local

# Task 504: Always fails (even after retries)
task=504
hostname=localhost
command=sh
arguments=-c "echo 'Task 504 - Always fails'; exit 1"
exec=local